<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>zizié£Ÿè°± - ä¿®å¤ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none !important; }
        .nav-btn { font-size: 1.5rem; transition: transform 0.2s; cursor: pointer; }
        .nav-btn:active { transform: scale(0.8); }
        .card { background: white; border-radius: 1rem; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen pb-24">

    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b p-4 flex justify-between items-center">
        <h1 class="text-xl font-black text-emerald-600">ğŸ¥˜ zizié£Ÿè°±</h1>
        <div id="user-status" class="text-xs font-bold text-gray-400">æ£€æŸ¥ç™»å½•ä¸­...</div>
    </header>

    <main id="view-home" class="p-4 max-w-xl mx-auto">
        <h2 class="text-2xl font-black mb-4">æ¨èèœè°±</h2>
        <div id="recipe-list" class="space-y-4"></div>
    </main>

    <main id="view-moment" class="p-4 max-w-xl mx-auto hidden">
        <h2 class="text-2xl font-black mb-4">ç¾é£Ÿç¬é—´</h2>
        <div id="moment-grid" class="grid grid-cols-2 gap-3"></div>
    </main>

    <main id="view-profile" class="p-6 max-w-xl mx-auto hidden">
        <div class="bg-white rounded-3xl p-8 text-center shadow-xl border border-gray-100">
            <div class="w-20 h-20 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center text-3xl font-bold mx-auto mb-4" id="avatar">ğŸ‘¤</div>
            <h2 class="text-xl font-black mb-2" id="profile-name">æ¸¸å®¢</h2>
            <p class="text-gray-400 text-sm mb-6" id="profile-email">ç™»å½•åå¼€å¯ç¾é£Ÿä¹‹æ—…</p>
            <button id="auth-action-btn" class="w-full py-4 bg-emerald-600 text-white rounded-2xl font-black shadow-lg shadow-emerald-200">å»ç™»å½• / æ³¨å†Œ</button>
        </div>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-lg border-t p-4 flex justify-around items-center z-40">
        <div id="to-home" class="nav-btn">ğŸ </div>
        <div id="to-moment" class="nav-btn">ğŸ“¸</div>
        <div id="to-post" class="bg-emerald-500 text-white w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg -mt-10 border-4 border-white">â•</div>
        <div id="to-profile" class="nav-btn">ğŸ‘¤</div>
    </nav>

    <script>
        const SB_URL = "https://kmsbrisiajtykflnskpj.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imttc2JyaXNpYWp0eWtmbG5za3BqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwODM2NzIsImV4cCI6MjA4NzY1OTY3Mn0.e8-qaJpmrGVc_GcWVEBHEUHWWiJ40Ax5BMyWTZsGqbE";
        
        let _sb;
        let _user = null;

        // æ ¸å¿ƒï¼šç­‰é¡µé¢åŠ è½½å®Œå†ç»‘å®šæŒ‰é’®ï¼Œé˜²æ­¢â€œç‚¹ä¸åŠ¨â€
        window.addEventListener('DOMContentLoaded', () => {
            console.log("App Ready");
            try {
                _sb = supabase.createClient(SB_URL, SB_KEY);
                bindEvents();
                checkUser();
            } catch (e) {
                console.error("Supabase Error:", e);
                document.getElementById('user-status').innerText = "æœåŠ¡æš‚æ—¶ç¦»çº¿";
            }
        });

        function bindEvents() {
            // åŸºç¡€å¯¼èˆªåˆ‡æ¢ (ä¿è¯å°±ç®—æ²¡ç½‘ä¹Ÿèƒ½ç‚¹)
            document.getElementById('to-home').onclick = () => switchView('home');
            document.getElementById('to-moment').onclick = () => switchView('moment');
            document.getElementById('to-profile').onclick = () => switchView('profile');
            
            // å‘å¸ƒæŒ‰é’®
            document.getElementById('to-post').onclick = () => {
                if(!_user) { switchView('profile'); alert("è¯·å…ˆç™»å½•å“¦"); }
                else { /* æ˜¾ç¤ºå‘å¸ƒå¼¹çª—çš„é€»è¾‘ */ }
            };

            // ç™»å½•/ç™»å‡ºæŒ‰é’®
            document.getElementById('auth-action-btn').onclick = () => {
                if(_user) handleLogout();
                else alert("ç‚¹å‡»é¡¶éƒ¨ç™»å½•æŒ‰é’®"); // è¿™é‡Œå¯ä»¥æ ¹æ®ä½ å…·ä½“çš„ç™»å½•å¼¹çª—æ”¹
            };
        }

        async function checkUser() {
            const { data: { session } } = await _sb.auth.getSession();
            _user = session?.user || null;
            updateUI();
            fetchData();
        }

        function updateUI() {
            const status = document.getElementById('user-status');
            const pName = document.getElementById('profile-name');
            const pEmail = document.getElementById('profile-email');
            const authBtn = document.getElementById('auth-action-btn');

            if(_user) {
                const name = _user.email.split('@')[0];
                status.innerText = `ä½ å¥½ï¼Œ${name}`;
                pName.innerText = name;
                pEmail.innerText = _user.email;
                authBtn.innerText = "é€€å‡ºç™»å½•";
                authBtn.classList.replace('bg-emerald-600', 'bg-red-500');
            } else {
                status.innerText = "æœªç™»å½•";
                pName.innerText = "æ¸¸å®¢";
                pEmail.innerText = "ç™»å½•åå¼€å¯ç¾é£Ÿä¹‹æ—…";
                authBtn.innerText = "å»ç™»å½• / æ³¨å†Œ";
            }
        }

        function switchView(name) {
            document.getElementById('view-home').classList.add('hidden');
            document.getElementById('view-moment').classList.add('hidden');
            document.getElementById('view-profile').classList.add('hidden');
            document.getElementById(`view-${name}`).classList.remove('hidden');
        }

        async function fetchData() {
            // æ•°æ®æŠ“å–é€»è¾‘ä¿æŒä¸å˜...
        }

        async function handleLogout() {
            await _sb.auth.signOut();
            location.reload();
        }
    </script>
</body>
</html>
